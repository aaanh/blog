<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Developing a Photo Reel with REST API Cloud Storage :: Anh&#39;s Tech Blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Gotta show off the nice photos." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.aaanh.com/posts/api-for-images/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://blog.aaanh.com/styles.css">







  <link rel="shortcut icon" href="https://blog.aaanh.com/img/theme-colors/green.png">
  <link rel="apple-touch-icon" href="https://blog.aaanh.com/img/theme-colors/green.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Developing a Photo Reel with REST API Cloud Storage">
<meta property="og:description" content="Gotta show off the nice photos." />
<meta property="og:url" content="https://blog.aaanh.com/posts/api-for-images/" />
<meta property="og:site_name" content="Anh&#39;s Tech Blog" />

  
    <meta property="og:image" content="https://blog.aaanh.com/img/favicon/green.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2022-12-31 15:30:00 &#43;0000 UTC" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Anh&#39;s Tech Blog
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;‚ñæ</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
  <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    
  </ul>
</nav>

  
  <div class="author">
    
    Created by&nbsp;<a href="https://aaanh.ca">Anh Hoang Nguyen</a> <img src="https://avatars.githubusercontent.com/u/37283437?v=4" width="128px" height="128px"> |&nbsp;<a href="https://github.com/aaanh/blog">Github</a>&nbsp;|&nbsp;<a href="https://twitter.com/aaaaaaaaaanh">Twitter</a>
  </div>
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.aaanh.com/posts/api-for-images/">Developing a Photo Reel with REST API Cloud Storage</a>
  </h1>
  <div class="post-meta">
    
      <time class="post-date">
        2022-12-31 ::
        
      </time>
    
    
    
  </div>

  
    <span class="post-tags">
      
      #<a href="https://blog.aaanh.com/tags/api/">api</a>&nbsp;
      
      #<a href="https://blog.aaanh.com/tags/web/">web</a>&nbsp;
      
      #<a href="https://blog.aaanh.com/tags/dev/">dev</a>&nbsp;
      
    </span>
  
  


  
    <div class="table-of-contents">
      <h2>
        Table of Contents
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#planning">Planning</a></li>
    <li><a href="#development">Development</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <p>When I have some free time, I sometimes go out and take photos of the sceneries and the urban landscapes with my camera setups. Usually afterwards I would just post on the usual social media, like Facebook or Instagram. After uploading for a while, I have come to the realization that hosting and serving the images on the usual platform is not the best way because the purpose of the content would get diluted by the noisy neighbours.</p>
<p>I also figured that hosting these on a specialized infrastructure and website would force me to learn new development techniques and knowledge plus the caveats that come with it. So, I set out to build one from scratch.</p>
<h2 id="planning">Planning<a href="#planning" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>My planning process is as follows:</p>
<ul>
<li>Figure out where to host the images
<ul>
<li>What requirements the image hosting infra needs to satisfy?
<ul>
<li>Basic GUI for uploading</li>
<li>Rate limiting</li>
<li>API support</li>
<li>Organization: by year, by tag</li>
</ul>
</li>
<li>The pricing
<ul>
<li>Free-tier (cuz I&rsquo;m always broke üôè)</li>
</ul>
</li>
<li>As long as it uses REST API, we&rsquo;re in business</li>
</ul>
</li>
<li>Developing the frontend gallery
<ul>
<li>Definitely React/Nextjs (at that time, I didn&rsquo;t know anything else)</li>
<li>Simple styling with vanilla Tailwindcss</li>
<li>Dynamically loading to save bandwidth and improve performance</li>
<li>Dynamically render the images according to the <code>year</code> tag</li>
<li>Retrieve the image list from the hosting platform</li>
<li>Simple gallery that renders the image in auto-sized columns</li>
<li>Hover image to zoom in</li>
</ul>
</li>
</ul>
<h2 id="development">Development<a href="#development" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>For serving an image to a visitor of your website, hosting the images is only half of the equation. Accessing a hosted resource on the cloud can simply be done with a HTTP request even from a terminal shell. Now, a low-tech option is hosting it on a baremetal server off the coast of the Bahamas and serve the assets via static URL with an Apache or NGINX server. Graduating from priamry school, I&rsquo;d get into hosting a database, more specifically in this case, a NoSQL database for the images. But then, to communicate with the database, I&rsquo;d need to develop a backend server that supports CRUD operations and REST API, not to mention I&rsquo;d also have to model the object storage. At this point, I got too lazy so the best thing I had in mind is to outsource that whole headaches to some SaaS products. These SaaS products would usually come with a Content Delivery Network (CDN). <a href="https://en.wikipedia.org/wiki/Content_delivery_network">Read more</a>.</p>
<p>After researching for an image hosting platform and disenchanted by the operational overheading of self-hosting a database + backend, I narrowed down to 2 options: Cloudflare and Cloudinary. Cloudflare, unfortunately as much as I like it, does not have a free-tier plan for images hosting and serving. So, I went with Cloudinary &ndash; which meant that I had to learn a whole new platform from the start.</p>
<p>I created a free account on Cloudinary and set up the stuff. First impression, the UI is a bit busy, but nowhere near the confundus puddle of confusion on AWS. I uploaded some images and tagged them and use the unique API URL to query the data. Everything seemed to go smoothly. The endpoint I tested returned a JSON object containing the all the uploaded images. See the following example.</p>
<p>The cURL request</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl --location --request GET <span style="color:#e6db74">&#39;https://api.cloudinary.com/v1_1/some_cloud_name/resources/image&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--header <span style="color:#e6db74">&#39;Authorization: Basic SOME=64BIT=ENCODED=SECRET&#39;</span>
</span></span></code></pre></div><p>The response body</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;resources&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;asset_id&#34;</span>: <span style="color:#e6db74">&#34;some_hex_id&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;public_id&#34;</span>: <span style="color:#e6db74">&#34;2022/some_file_name.jpg&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;jpg&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#ae81ff">1672194970</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;resource_type&#34;</span>: <span style="color:#e6db74">&#34;image&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;upload&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;created_at&#34;</span>: <span style="color:#e6db74">&#34;2022-12-28T02:36:10Z&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;bytes&#34;</span>: <span style="color:#ae81ff">1153399</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;width&#34;</span>: <span style="color:#ae81ff">4032</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;height&#34;</span>: <span style="color:#ae81ff">3024</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;folder&#34;</span>: <span style="color:#e6db74">&#34;2022&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;http://res.cloudinary.com/some_cloud_name/image/upload/some_unique_id/2022/some_file_name.jpg&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;secure_url&#34;</span>: <span style="color:#e6db74">&#34;https://res.cloudinary.com/some_cloud_name/image/upload/some_unique_id/2022/some_file_name.jpg&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>LGTM! So I dug further into the documentation and found out how to query by tag &ndash; which is important for me to query the images by year. I also noticed the &ldquo;Transformations&rdquo; doc and decided to check out what it is. To my pleasant surprise, Cloudinary has a feature where you can add query params to the request and it would respond with the resized images.</p>
<p>Then, I crafted a GET request with the fetch API + useSWR on the Nextjs application. Like so&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getStaticProps</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">year</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">images</span>.<span style="color:#a6e22e">resources</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">image</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">secure_url</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">45</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/w_500,c_scale&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">secure_url</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">45</span>)),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">public_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">public_id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">folder</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">folder</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">width</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">height</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">format</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">format</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This acts as a middleware that queries my Cloudinary library for images, does some magical string operations that I cooked up and have now forgotten how to generate the correct URL, and outputs that to the Nextjs API endpoint. So every time, I want to retrieve the data, I could fetch the application URL instead of going directly to the Cloudinary endpoint which would save me on the number of requests.</p>
<p>After verifying that the images matching the query are soundly returned in the response body, all that was left was to design the frontend for which I mushed and mashed together some HTML code and Tailwindcss classes. Bing, bam, boom.</p>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>In terms of performance, I have not got to optimizing that much but the website should load almost instantly on first visit because of the minimal size of frontend code that I used for the design. The images on the other hand took quite a bit more, on average 1-2 seconds for the images in a tagged year to load.</p>
<p>I have never reached the rate limitation of the free-tier quota and averages at around 1% plan usage per month. The images were exported in JPG format with Best Quality selected in Lightroom and average at around 1MB each for a running total of ~35 images rendered on the frontend. Disregarding the intial upload size, the images are already transformed into even smaller files in size at around 500KB.</p>
<p>Visit the photo gallery at: <a href="https://photos.aaanh.ca">https://photos.aaanh.ca</a></p>
<p>Source code is available at: [ <a href="https://github.com/aaanh/my-photo-reel">Github</a> ]</p>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://blog.aaanh.com/posts/migrating-google-microsoft/">
                <span class="button__icon">‚Üê</span>
                <span class="button__text">Migrating from Google Workspace to Microsoft 365</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://blog.aaanh.com/posts/rendering-html-from-latex/">
                <span class="button__text">Rendering Static HTML from LaTeX Source: A Madness-Inducing Adventure</span>
                <span class="button__icon">‚Üí</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>¬© 2023 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
