<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Setting Up a Barebone Dedicated ML Server :: Anh&#39;s Tech Blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="I sure hope that I will make-even with this investment 💸" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.aaanh.com/posts/setting-up-a-barebone-ml-server/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://blog.aaanh.com/styles.css">







  <link rel="shortcut icon" href="https://blog.aaanh.com/img/theme-colors/green.png">
  <link rel="apple-touch-icon" href="https://blog.aaanh.com/img/theme-colors/green.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Setting Up a Barebone Dedicated ML Server">
<meta property="og:description" content="I sure hope that I will make-even with this investment 💸" />
<meta property="og:url" content="https://blog.aaanh.com/posts/setting-up-a-barebone-ml-server/" />
<meta property="og:site_name" content="Anh&#39;s Tech Blog" />

  
    <meta property="og:image" content="https://blog.aaanh.com/img/favicon/green.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2022-07-23 00:00:00 &#43;0000 UTC" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Anh&#39;s Tech Blog
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
  <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    
  </ul>
</nav>

  
  <div class="author">
    
    Created by&nbsp;<a href="https://aaanh.ca">Anh Hoang Nguyen</a> <img src="https://avatars.githubusercontent.com/u/37283437?v=4" width="128px" height="128px"> |&nbsp;<a href="https://github.com/aaanh/blog">Github</a>&nbsp;|&nbsp;<a href="https://twitter.com/aaaaaaaaaanh">Twitter</a>
  </div>
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.aaanh.com/posts/setting-up-a-barebone-ml-server/">Setting Up a Barebone Dedicated ML Server</a>
  </h1>
  <div class="post-meta">
    
      <time class="post-date">
        2022-07-23 ::
        
      </time>
    
    
    
  </div>

  
    <span class="post-tags">
      
      #<a href="https://blog.aaanh.com/tags/mlops/">mlops</a>&nbsp;
      
      #<a href="https://blog.aaanh.com/tags/exploratory/">exploratory</a>&nbsp;
      
      #<a href="https://blog.aaanh.com/tags/research/">research</a>&nbsp;
      
      #<a href="https://blog.aaanh.com/tags/linux/">linux</a>&nbsp;
      
      #<a href="https://blog.aaanh.com/tags/hardware/">hardware</a>&nbsp;
      
      #<a href="https://blog.aaanh.com/tags/tinkering/">tinkering</a>&nbsp;
      
    </span>
  
  


  
    <div class="table-of-contents">
      <h2>
        Table of Contents
      </h2>
      <nav id="TableOfContents"></nav>
    </div>
  

  <div class="post-content"><div>
        <h1 id="the-purchase">The Purchase<a href="#the-purchase" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Back in July 2, after a bi-weekly report on my research progress to the group, I headed to eBay to buy a dedicated GPU for the machine learning tasks that I am performing. The reason, to quell my predictable buyer&rsquo;s remorse, was to have a separate accelerator card from my workstation that runs on my homelab server instead. This card would need to have a (more) massive physical memory than the measly 8GB that my GTX 1080 has and quite a lot cheaper to actually justify the purchase.</p>
<p>After digging around for few hours, I stumbled upon the NVidia Tesla M40 GPU. It is a data-center class GPU based on the <strong>M</strong>axwell architecture.</p>
<p>Here are the specifications:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>GPU Architecture</td>
<td>NVIDIA Maxwell</td>
</tr>
<tr>
<td>CUDA Cores</td>
<td>3072</td>
</tr>
<tr>
<td>Single-Precision Perf</td>
<td>7 TFlops w/ NVIDIA GPU Boost</td>
</tr>
<tr>
<td>Double-Precision Perf</td>
<td>0.2 TFlops</td>
</tr>
<tr>
<td>GPU Memory</td>
<td>24 GB GDDR5</td>
</tr>
<tr>
<td>Memory Bandwidth</td>
<td>288 GB/s</td>
</tr>
<tr>
<td>Interface</td>
<td>PCIe 3.0 x16</td>
</tr>
<tr>
<td>Max Power Consumption</td>
<td>250 W</td>
</tr>
<tr>
<td>Cooling</td>
<td>Passive</td>
</tr>
</tbody>
</table>
<p>While it is a 7-years-old GPU, considering the price of <code>US$179</code> and three-times the GPU memory of my GTX 1080, I was quite sold on the idea of getting it. The very significant outcome is that I would be able to train on larger batch sizes and perform more aggressive feature engineering tasks.</p>
<h1 id="the-delivery-rant-skip-ahead">The Delivery (rant, skip ahead)<a href="#the-delivery-rant-skip-ahead" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<!-- raw HTML omitted -->
<p>I smelled an absolute dogshit stench combined with fermented fishiness that it was utter horseshit. First, it came from the fact that I had never provided any signature for any delivery. Second, there was no delivery attempt, no phone calls, no SMS. But I checked the vicinity of the house anyway just to be sure. To no one&rsquo;s surprise, it wasn&rsquo;t there. I checked the tracking on the website and it still said delivered. WTF?</p>
<p>The next morning, I called Intelcom&rsquo;s customer support. It was not easy finding the customer support number either, because there was (and I guarantee still is) nothing listed on the official website. What a fucking shady business that operates on anti-consumerism. Anyway, I waited 20 minutes on a line until I finally got transferred to an agent. The problem seemed to be an incorrect shipping address on the system <code>?? 🙂 ??</code>. Whatever I&rsquo;d just provide again the correct address and it&rsquo;d be good (right?) and the delivery was still scheduled for Monday. Came Monday, an e-mail came around 4:00 PM saying that the GPU would be delivered from 5:00 PM to 10:00 PM. Said time period came, and I got a call from the delivery person asking for the correct address. What the fuck? Didn&rsquo;t I just correct it on Sunday? Was I sleep-dialing customer support in my dream? Okay fine, I gave the person the correct address and the motherfucker literally had the gall to say that it was too far away (30 minutes) from his location so he didn&rsquo;t want to deliver (????). I&rsquo;m sorry, but ain&rsquo;t the delivery time between 5 to 10? It was fucking 5:30 PM at that time.</p>
<p>To be abridged and shortened, I dealt with customer support for 2 additional times on the phone, each lasting around 30-40 minutes just to harass them to do the right thing or else I would report their ass to kingdom come with Quebec Consumer Protection Office and drag their faces through the mud on Better Business Bureau. And it motherfucking worked. I finally got the GPU on Thursday.</p>
<!-- raw HTML omitted -->
<h1 id="the-installation">The Installation<a href="#the-installation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>After installing the card in my server, I realized that the PSU didn&rsquo;t have enough power (450 W) to run the whole system with the M40 GPU. So, I ran to the nearest Canada Computers and picked up a 650 W PSU. I had to saw off the second CPU power connector clip in order to fit the card&rsquo;s power slot. And&hellip; It still didn&rsquo;t work.</p>
<p>Perusing the great interweb for an hour or so, I came across a YouTube video that said I would need to enable something-something more than 4-GB decoding(?) in BIOS for it to work. The main problem was I had been running the server headlessly. That is, only through SSH and no user I/O whatsoever.</p>
<p>To solve this, I devised 2 options:</p>
<ol>
<li>Buy a CPU with iGPU (my current one doesn&rsquo;t have one)</li>
<li>Buy a cheap-ass GPU</li>
</ol>
<p>For option, the most sensible thing was to get a Ryzen 3200G (I am running on an AMD motherboard). But it costs around 300 dollary-doos. On the other hand, a cheap-ass GPU would only cost me 99 Canadian rupees in total, so I went for the latter and bought a Radeon card off Amazon.</p>
<p>Card arrived. BIOS configured. System booted to OS. And working fine.</p>
<h1 id="the-nvidia-installation">The NVIDIA Installation<a href="#the-nvidia-installation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>The card would totally not work if there ain&rsquo;t any drivers, especially for machine learning that utilizes those sweet CUDA cores.</p>
<p>I first disabled the default Nouveau driver:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo su
</span></span><span style="display:flex;"><span>touch /etc/modprobe.d/blacklist-nouveau.conf
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;blacklist nouveau\noptions nouveau modeset=0&#34;</span> &gt;&gt; /etc/modprobe.d/blacklist-nouveau.conf
</span></span><span style="display:flex;"><span>update-initramfs -u
</span></span><span style="display:flex;"><span>reboot
</span></span></code></pre></div><p>Then, I installed the CUDA Toolkit using the Runfile method for easy clap:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>wget https://developer.download.nvidia.com/compute/cuda/11.7.0/local_installers/cuda_11.7.0_515.43.04_linux.run
</span></span><span style="display:flex;"><span>sudo sh cuda_11.7.0_515.43.04_linux.run
</span></span></code></pre></div><p>Then, I installed <code>anaconda</code> (for demo only, please refer to Anaconda official website for latest downloads):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>wget https://repo.anaconda.com/archive/Anaconda3-2022.05-Linux-x86_64.sh <span style="color:#f92672">&amp;&amp;</span> bash Anaconda3-2022.05-Linux-x86_64.sh
</span></span></code></pre></div><p>After that, I created a new environment, installed Jupyter Notebook and dependencies. And finally, I ran the first ever training (pictured below). I made sure to monitor the GPU usage through <code>nvidia-smi</code> to verify if it was utilizing the GPU, not the CPU.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="afterwords">Afterwords<a href="#afterwords" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Looking at the whole process, I spent around <code>CA$350</code> in total for the GPU + compatible components + other efforts. Comparing that one-time price tag (electricity excluded) to Google Colab (<code>CA$15</code> a month if I remember correctly), I should be able to breakeven in 2 years. However, it should be taken into considerations that Google Colab has timeouts and the GPU instance provided is not guaranteed, so on a good day, you might get A100 or V100, but on a bad day, you would get the whimpy K80. Adding more to the variance, you are also dependent on the storage space of your Google Drive to store models and data, which adds 5 - 15 dollars a month for a usable amount of storage. Thus, bringing down the breakeven period to simply less than 1 year of continuous usage.</p>
<p>In the near future, I would want to experiment with distributed machine learning setup between the server and my workstation to see if it has any larger potential with performance gain.</p>
<p>Subjectively, I think the effort was worthwhile. Though, it would have been way better if it was not for Intelcom. I&rsquo;m calling that shitty company out. Keep that in your mind: Intelcom is bad.</p>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://blog.aaanh.com/posts/serverless-functions/">
                <span class="button__icon">←</span>
                <span class="button__text">A Cute and Neat Serverless Function for Github Gists</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://blog.aaanh.com/posts/why-be-a-king/">
                <span class="button__text">When you can be a 2D Anime Waifu Oshi</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2023 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
